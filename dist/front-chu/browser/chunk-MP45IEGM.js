import{a as d}from"./chunk-V6I33QLD.js";import{c as u,g as m}from"./chunk-YLHBJJO7.js";import{_ as n,c as p,da as g,ia as l}from"./chunk-EIVDWLNO.js";import{a as i,b as r}from"./chunk-4CLCTAJ7.js";var b=class a{constructor(e){this.http=e}API_URL=d.apiUrl;getAllDocuments(e){let t=new u;return e&&(e.page&&(t=t.set("page",e.page.toString())),e.per_page&&(t=t.set("per_page",e.per_page.toString())),e.source_table&&(t=t.set("source_table",e.source_table)),e.type_document&&(t=t.set("type_document",e.type_document.toString())),e.souscription_id&&(t=t.set("souscription_id",e.souscription_id.toString())),e.statut&&(t=t.set("statut",e.statut)),e.date_debut&&(t=t.set("date_debut",e.date_debut)),e.date_fin&&(t=t.set("date_fin",e.date_fin)),e.search&&(t=t.set("search",e.search))),this.http.get(`${this.API_URL}/documents`,{params:t}).pipe(n(s=>{console.log("Tous les documents r\xE9cup\xE9r\xE9s:",s),console.log("Nombre total de documents:",s.data?.length||0)}))}getMesDocuments(e){let t=new u;return e&&(e.page&&(t=t.set("page",e.page.toString())),e.per_page&&(t=t.set("per_page",e.per_page.toString())),e.source_table&&(t=t.set("source_table",e.source_table)),e.type_document&&(t=t.set("type_document",e.type_document.toString())),e.souscription_id&&(t=t.set("souscription_id",e.souscription_id.toString())),e.statut&&(t=t.set("statut",e.statut)),e.date_debut&&(t=t.set("date_debut",e.date_debut)),e.date_fin&&(t=t.set("date_fin",e.date_fin)),e.search&&(t=t.set("search",e.search))),this.http.get(`${this.API_URL}/documents/utilisateur`,{params:t}).pipe(n(s=>{console.log("Mes documents r\xE9cup\xE9r\xE9s:",s)}))}getDocumentById(e){return this.http.get(`${this.API_URL}/documents/${e}`).pipe(n(t=>{console.log("Document r\xE9cup\xE9r\xE9:",t)}))}telechargerDocument(e){return this.http.get(`${this.API_URL}/documents/${e}/download`,{responseType:"blob"}).pipe(n(()=>{console.log("Document t\xE9l\xE9charg\xE9 pour l'ID:",e)}))}visualiserDocument(e){return new p(t=>{this.telechargerDocument(e).subscribe({next:s=>{let o=window.URL.createObjectURL(s);t.next(o),t.complete()},error:s=>{t.error(s)}})})}getDocumentsBySource(e,t){let s=r(i({},t),{source_table:e});return this.getAllDocuments(s)}getDocumentsBySouscription(e,t){let s=r(i({},t),{souscription_id:e});return this.getAllDocuments(s)}rechercherDocuments(e,t){let s=r(i({},t),{search:e});return this.getAllDocuments(s)}getDocumentUrl(e){if(!e)return console.warn("\u{1F534} Chemin fichier vide ou null"),this.getImagePlaceholder();let t=e.replace(/^\/+|\/+$/g,"");t.startsWith("documents/")||(t=`documents/${t}`);let s=this.API_URL.replace("/api",""),o=`${s}/storage/${t}`;return console.log("\u{1F50D} URL g\xE9n\xE9r\xE9e pour document:",{cheminOriginal:e,cheminNettoye:t,urlComplete:o,baseUrl:s}),o}ajouterDocumentSouscripteur(e){return this.http.post(`${this.API_URL}/dossier-souscripteur`,e).pipe(n(t=>{console.log("Document souscripteur ajout\xE9:",t)}))}isImage(e){if(!e)return!1;let t=e.split(".").pop()?.toLowerCase()||"",s=["jpg","jpeg","png","gif","webp","svg","bmp","tiff","ico"].includes(t);return console.log(`\u{1F4F8} Test image - Fichier: ${e} | Extension: ${t} | Est image: ${s}`),s}isVideo(e){if(!e)return!1;let t=e.split(".").pop()?.toLowerCase()||"",s=["mp4","avi","mov","wmv","flv","webm","mkv","m4v","3gp","ogv"].includes(t);return console.log(`\u{1F3A5} Test vid\xE9o - Fichier: ${e} | Extension: ${t} | Est vid\xE9o: ${s}`),s}isAudio(e){if(!e)return!1;let t=e.split(".").pop()?.toLowerCase()||"";return["mp3","wav","ogg","aac","flac","m4a","wma"].includes(t)}isMediaFile(e){if(!e||!e.nom_original)return!1;let t=this.isImage(e.nom_original)||this.isVideo(e.nom_original)||this.isAudio(e.nom_original),s=e.type_mime&&(e.type_mime.startsWith("image/")||e.type_mime.startsWith("video/")||e.type_mime.startsWith("audio/"));return t||s}getImagePlaceholder(){return"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM5Y2ExYWEiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBub24gZGlzcG9uaWJsZTwvdGV4dD4KPC9zdmc+"}filterImages(e){return!e||!Array.isArray(e)?[]:e.filter(t=>{let s=t.nom_original?.split(".").pop()?.toLowerCase()||"",o=["jpg","jpeg","png","gif","webp","svg","bmp"].includes(s),c=t.type_mime?.startsWith("image/")||!1;return o||c})}filterVideos(e){return!e||!Array.isArray(e)?[]:e.filter(t=>{let s=t.nom_original?.split(".").pop()?.toLowerCase()||"",o=["mp4","avi","mov","wmv","flv","webm","mkv","m4v"].includes(s),c=t.type_mime?.startsWith("video/")||!1;return o||c})}testImageUrl(e){return console.log("\u{1F9EA} Test de l'URL:",e),new Promise(t=>{let s=new Image;s.onload=()=>{console.log("\u2705 URL accessible:",e),t(!0)},s.onerror=()=>{console.log("\u274C URL inaccessible:",e),t(!1)},s.src=e,setTimeout(()=>{console.log("\u23F1\uFE0F Timeout pour URL:",e),t(!1)},5e3)})}formatTailleFichier(e){return!e||e===0?"0 B":e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`}getFileIcon(e){if(!e)return"file";switch(e.split(".").pop()?.toLowerCase()){case"pdf":return"file-pdf";case"doc":case"docx":return"file-word";case"xls":case"xlsx":return"file-excel";case"ppt":case"pptx":return"file-powerpoint";case"jpg":case"jpeg":case"png":case"gif":case"webp":case"svg":case"bmp":return"file-image";case"mp4":case"avi":case"mov":case"wmv":case"flv":case"webm":case"mkv":return"file-video";case"mp3":case"wav":case"ogg":case"aac":case"flac":return"file-audio";case"zip":case"rar":case"7z":return"file-zip";case"txt":return"file-text";case"csv":return"file-csv";default:return"file"}}getStatutClass(e){switch(e.toLowerCase()){case"actif":return"badge-success";case"archive":return"badge-secondary";case"supprime":return"badge-danger";case"en_cours":return"badge-warning";case"valide":return"badge-success";case"rejete":return"badge-danger";default:return"badge-primary"}}getStatutLabel(e){switch(e.toLowerCase()){case"actif":return"Actif";case"archive":return"Archiv\xE9";case"supprime":return"Supprim\xE9";case"en_cours":return"En cours";case"valide":return"Valid\xE9";case"rejete":return"Rejet\xE9";default:return e}}isRecent(e){if(!e)return!1;let t=new Date,s=new Date(e);return Math.ceil((t.getTime()-s.getTime())/(1e3*60*60*24))<=7}debugDocumentUrl(e){console.group(`\u{1F50D} Debug Document: ${e.nom_original}`),console.log("Document complet:",e),console.log("Chemin original:",e.chemin_fichier),console.log("URL g\xE9n\xE9r\xE9e:",this.getDocumentUrl(e.chemin_fichier)),console.log("Type d\xE9tect\xE9:",{isImage:this.isImage(e.nom_original),isVideo:this.isVideo(e.nom_original),isAudio:this.isAudio(e.nom_original)}),console.log("Type MIME:",e.type_mime),console.groupEnd()}static \u0275fac=function(t){return new(t||a)(l(m))};static \u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"})};export{b as a};
