import{a as m}from"./chunk-M37DKQAG.js";import{c as r,g}from"./chunk-YLHBJJO7.js";import{_ as n,da as u,ia as c,r as o}from"./chunk-EIVDWLNO.js";var d=class a{constructor(t){this.http=t}API_URL=m.apiUrl;getAllSouscriptions(t){let e=new r;return t&&(t.page&&(e=e.set("page",t.page.toString())),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.statut&&(e=e.set("statut",t.statut)),t.date_debut&&(e=e.set("date_debut",t.date_debut)),t.date_fin&&(e=e.set("date_fin",t.date_fin)),t.superficie&&(e=e.set("superficie",t.superficie.toString())),t.terrain_id&&(e=e.set("terrain_id",t.terrain_id.toString())),t.search&&(e=e.set("search",t.search)),t.all_users&&(e=e.set("all_users","true")),t.admin_view&&(e=e.set("admin_view","true"))),this.http.get(`${this.API_URL}/souscriptions`,{params:e}).pipe(n(s=>{console.log("\u{1F4CB} Souscriptions r\xE9cup\xE9r\xE9es:",s)}))}getAllDemandeSouscriptions(t){let e=new r;return t&&(t.page&&(e=e.set("page",t.page.toString())),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.statut&&(e=e.set("statut",t.statut)),t.date_debut&&(e=e.set("date_debut",t.date_debut)),t.date_fin&&(e=e.set("date_fin",t.date_fin)),t.superficie&&(e=e.set("superficie",t.superficie.toString())),t.terrain_id&&(e=e.set("terrain_id",t.terrain_id.toString())),t.search&&(e=e.set("search",t.search)),t.all_users&&(e=e.set("all_users","true")),t.admin_view&&(e=e.set("admin_view","true"))),this.http.get(`${this.API_URL}/souscriptions/demandes`,{params:e}).pipe(n(s=>{console.log("\u{1F4CB} demandes de Souscriptions r\xE9cup\xE9r\xE9es:",s)}))}getMesSouscriptions(t){let e=new r;return t&&(t.page&&(e=e.set("page",t.page.toString())),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.statut&&(e=e.set("statut",t.statut)),t.date_debut&&(e=e.set("date_debut",t.date_debut)),t.date_fin&&(e=e.set("date_fin",t.date_fin)),t.superficie&&(e=e.set("superficie",t.superficie.toString())),t.search&&(e=e.set("search",t.search))),this.http.get(`${this.API_URL}/souscriptions/utilisateur`,{params:e}).pipe(n(s=>{console.log("\u{1F464} Mes souscriptions r\xE9cup\xE9r\xE9es:",s)}))}getSouscriptionById(t){return this.http.get(`${this.API_URL}/souscriptions/${t}`).pipe(n(e=>{console.log("\u{1F4C4} Souscription r\xE9cup\xE9r\xE9e:",e)}))}getMesStatistiques(){return this.http.get(`${this.API_URL}/mes-souscriptions/statistiques`).pipe(o(t=>t.data),n(t=>{console.log("\u{1F4CA} Statistiques de mes souscriptions:",t)}))}getPlansPaiement(t){return this.http.get(`${this.API_URL}/souscriptions/${t}/plans-paiement`).pipe(o(e=>e.data),n(e=>{console.log("\u{1F4B3} Plans de paiement r\xE9cup\xE9r\xE9s:",e)}))}getMesProchainesEcheances(t=5){let e=new r().set("limit",t.toString());return this.http.get(`${this.API_URL}/mes-souscriptions/prochaines-echeances`,{params:e}).pipe(o(s=>s.data),n(s=>{console.log("\u23F0 Prochaines \xE9ch\xE9ances:",s)}))}createSouscription(t){return this.http.post(`${this.API_URL}/souscriptions`,t).pipe(n(e=>{console.log("\u2705 Souscription cr\xE9\xE9e:",e)}))}updateSouscription(t,e){return this.http.put(`${this.API_URL}/souscriptions/${t}`,e).pipe(n(s=>{console.log("\u270F\uFE0F Souscription mise \xE0 jour:",s)}))}deleteSouscription(t){return this.http.delete(`${this.API_URL}/souscriptions/${t}`).pipe(n(e=>{console.log("\u{1F5D1}\uFE0F Souscription supprim\xE9e:",e)}))}effectuerPaiement(t,e){return this.http.post(`${this.API_URL}/plans-paiement/${t}/paiement`,e).pipe(n(s=>{console.log("\u{1F4B0} Paiement effectu\xE9:",s)}))}telechargerRecu(t){return this.http.get(`${this.API_URL}/plans-paiement/${t}/recu`,{responseType:"blob"}).pipe(n(()=>{console.log("\u{1F4C4} Re\xE7u t\xE9l\xE9charg\xE9 pour le plan:",t)}))}rechercherSouscriptions(t,e){let s=new r().set("search",t);return e&&(e.page&&(s=s.set("page",e.page.toString())),e.per_page&&(s=s.set("per_page",e.per_page.toString())),e.statut&&(s=s.set("statut",e.statut)),e.terrain_id&&(s=s.set("terrain_id",e.terrain_id.toString()))),this.http.get(`${this.API_URL}/souscriptions/recherche`,{params:s}).pipe(n(i=>{console.log("\u{1F50D} R\xE9sultats de recherche:",i)}))}exporterSouscriptions(t,e){let s=new r().set("format",t);return e&&(e.statut&&(s=s.set("statut",e.statut)),e.date_debut&&(s=s.set("date_debut",e.date_debut)),e.date_fin&&(s=s.set("date_fin",e.date_fin))),this.http.get(`${this.API_URL}/souscriptions/export`,{params:s,responseType:"blob"}).pipe(n(()=>{console.log("\u{1F4CA} Export de souscriptions g\xE9n\xE9r\xE9 en format:",t)}))}parseAmount(t){return parseFloat(t)||0}formatCurrency(t){let e=typeof t=="string"?this.parseAmount(t):t;return new Intl.NumberFormat("fr-CI",{style:"currency",currency:"XOF",minimumFractionDigits:0}).format(e)}calculateCompletionPercentage(t){let e=parseFloat(t.montant_total_souscrit?.toString()||"0"),s=this.parseAmount(t.montant_paye||"0");return e===0?0:s/e*100}getEcheanceUrgency(t){let e=new Date,s=new Date(t),i=Math.ceil((s.getTime()-e.getTime())/(1e3*60*60*24));return i<0?"urgent":i<=7?"proche":"normal"}calculateSouscriptionStatus(t){if(!t)return"en_attente";let e=parseFloat(t.montant_total_souscrit?.toString()||"0"),s=this.parseAmount(t.montant_paye||"0"),i=Math.max(0,e-s),p=t.date_prochain,l=new Date;if(i===0)return"termine";if(p)try{if(new Date(p)<l)return"en_retard"}catch{console.warn("Date invalide pour date_prochain:",p)}return s>0?"en_cours":t.statut_souscription||"en_attente"}getStatusWithColor(t){let e=t.statut_souscription||this.calculateSouscriptionStatus(t);switch(e){case"active":return{status:e,color:"blue",label:"Active"};case"suspendu":return{status:e,color:"orange",label:"Suspendu"};case"supendu":return{status:e,color:"orange",label:"Suspendu"};case"terminer":return{status:e,color:"green",label:"Termin\xE9"};case"termine":return{status:e,color:"green",label:"Termin\xE9"};case"resilier":return{status:e,color:"gray",label:"R\xE9sili\xE9"};case"en_attente":return{status:e,color:"cyan",label:"En attente"};case"rejete":return{status:e,color:"red",label:"Rejet\xE9"};case"en_cours":return{status:e,color:"primary",label:"En cours"};case"en_retard":return{status:e,color:"danger",label:"En retard"};case"annule":return{status:e,color:"secondary",label:"Annul\xE9"};default:return{status:e,color:"info",label:"Active"}}}getTerrains(){return this.http.get(`${this.API_URL}/terrains`).pipe(o(t=>t.data),n(t=>console.log("\u{1F30D} Terrains r\xE9cup\xE9r\xE9s:",t)))}createDemandeSouscription(t){return this.http.post(`${this.API_URL}/souscriptions/demandes`,t).pipe(n(e=>{console.log("\u{1F4DD} Demande de souscription cr\xE9\xE9e:",e)}))}getMesDemandesSouscriptions(t){let e=new r;return t&&(t.page&&(e=e.set("page",t.page.toString())),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.statut&&(e=e.set("statut",t.statut)),t.date_debut&&(e=e.set("date_debut",t.date_debut)),t.date_fin&&(e=e.set("date_fin",t.date_fin)),t.superficie&&(e=e.set("superficie",t.superficie.toString())),t.search&&(e=e.set("search",t.search))),this.http.get(`${this.API_URL}/souscriptions/demandes/utilisateur`,{params:e}).pipe(n(s=>{console.log("\u{1F464} Mes demandes de souscription r\xE9cup\xE9r\xE9es:",s)}))}static \u0275fac=function(e){return new(e||a)(c(g))};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{d as a};
