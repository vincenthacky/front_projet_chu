import './polyfills.server.mjs';
import{a as D}from"./chunk-33EKPQNC.mjs";import{a as Ge,b as Ye}from"./chunk-QO3OO3C5.mjs";import{e as Je}from"./chunk-GMAFPMIL.mjs";import{c as pe}from"./chunk-6XJHF3EK.mjs";import{g as Be}from"./chunk-VDKS4F7J.mjs";import{a as E}from"./chunk-UXMXYT5B.mjs";import{A as Xe}from"./chunk-W7BGEYBY.mjs";import{G as Ve,H as ze,a as ge,b as ve,c as Ce,d as ye,e as Me,f as Oe,g as Te,h as Ee,i as Se,j as Re,k as Ie,l as be,m as _e,n as Pe,o as xe,p as Ae,q as Ne,r as we,s as De,t as Fe,u as ke,v as $e,w as He,x as Ue,y as je,z as Le}from"./chunk-DXOQ4KLL.mjs";import{i as We,n as Ke}from"./chunk-KHW4IOFH.mjs";import{c as me,e as fe,g as he}from"./chunk-LI7RJ6PT.mjs";import{f as ae,h as w,j as se,k as le,o as ce,p as de,s as ue}from"./chunk-UXVSRWVF.mjs";import{C as T,d as oe,r as ne,t as ie,v as re}from"./chunk-SYXLOHCJ.mjs";import{Aa as P,Bb as m,Cb as q,E as U,Ha as B,Nc as ee,Oa as J,Ob as c,Pb as h,Qb as g,Ub as Q,_b as x,a as k,aa as j,ac as v,cb as G,da as l,dd as te,f as $,ga as L,hb as p,ib as Y,ja as u,jb as W,jc as A,kc as N,lb as K,nb as X,o as d,oa as y,qb as Z,r as H,sa as V,sc as O,ta as z,xb as M,za as _}from"./chunk-OQNIVP4F.mjs";var f=class n{modalSubject=new $;modal$=this.modalSubject.asObservable();showModal(t){this.modalSubject.next(t)}hideModal(){this.modalSubject.next(null)}showAccountSuspendedModal(){this.showModal({title:"Compte Suspendu",message:"Votre compte a \xE9t\xE9 suspendu ou est inactif. Veuillez contacter l'administrateur.",imageSrc:"Do-not-enter-sign-bro.png",duration:4e3,type:"error"})}showConnectionErrorModal(){this.showModal({title:"Connexion au serveur impossible",message:"Impossible de se connecter au serveur de donn\xE9es. Veuillez v\xE9rifier votre connexion r\xE9seau et r\xE9essayer.",imageSrc:"Do-not-enter-sign-bro.png",duration:4e3,type:"error"})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};function rt(n,t){if(n&1&&g(0,"img",11),n&2){let e=v(2);m("src",e.currentModal==null?null:e.currentModal.imageSrc,G)("alt",e.currentModal==null?null:e.currentModal.title)}}function at(n,t){if(n&1&&(c(0,"div",12),g(1,"div",13),h()),n&2){let e=v(2);p(),q("animation-duration",e.currentModal==null?null:e.currentModal.duration,"ms")}}function st(n,t){if(n&1){let e=Q();c(0,"div",1),x("click",function(){_(e);let i=v();return P(i.onOverlayClick())}),c(1,"div",2),x("click",function(i){return _(e),P(i.stopPropagation())}),c(2,"div",3)(3,"div",4),M(4,rt,1,2,"img",5),c(5,"h3",6),A(6),h()(),c(7,"div",7)(8,"p",8),A(9),h()(),c(10,"div",9),M(11,at,2,2,"div",10),h()()()()}if(n&2){let e=v();p(2),m("ngClass","modal-"+(e.currentModal==null?null:e.currentModal.type)),p(2),m("ngIf",e.currentModal==null?null:e.currentModal.imageSrc),p(2),N(e.currentModal==null?null:e.currentModal.title),p(3),N(e.currentModal==null?null:e.currentModal.message),p(2),m("ngIf",e.currentModal==null?null:e.currentModal.duration)}}var S=class n{constructor(t){this.modalService=t}isVisible=!1;currentModal=null;subscription=new k;autoCloseTimer;ngOnInit(){this.subscription.add(this.modalService.modal$.subscribe(t=>{t?this.showModal(t):this.hideModal()}))}ngOnDestroy(){this.subscription.unsubscribe(),this.autoCloseTimer&&clearTimeout(this.autoCloseTimer)}showModal(t){this.currentModal=t,this.isVisible=!0,t.duration&&t.duration>0&&(this.autoCloseTimer=window.setTimeout(()=>{this.hideModal()},t.duration))}hideModal(){this.isVisible=!1,this.autoCloseTimer&&(clearTimeout(this.autoCloseTimer),this.autoCloseTimer=void 0)}onOverlayClick(){this.hideModal(),this.modalService.hideModal()}static \u0275fac=function(e){return new(e||n)(Y(f))};static \u0275cmp=y({type:n,selectors:[["app-notification-modal"]],standalone:!0,features:[O],decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-container",3,"click"],[1,"modal-content",3,"ngClass"],[1,"modal-header"],["class","modal-icon",3,"src","alt",4,"ngIf"],[1,"modal-title"],[1,"modal-body"],[1,"modal-message"],[1,"modal-footer"],["class","progress-bar",4,"ngIf"],[1,"modal-icon",3,"src","alt"],[1,"progress-bar"],[1,"progress-fill"]],template:function(e,o){e&1&&M(0,st,12,5,"div",0),e&2&&m("ngIf",o.isVisible)},dependencies:[T,ie,re],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000000b3;display:flex;justify-content:center;align-items:center;z-index:9999;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.modal-container[_ngcontent-%COMP%]{max-width:500px;width:90%;max-height:90%;animation:_ngcontent-%COMP%_slideIn .3s ease-out}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 20px 50px #0000004d;overflow:hidden;position:relative}.modal-error[_ngcontent-%COMP%]{border-top:4px solid #dc3545}.modal-warning[_ngcontent-%COMP%]{border-top:4px solid #ffc107}.modal-info[_ngcontent-%COMP%]{border-top:4px solid #17a2b8}.modal-success[_ngcontent-%COMP%]{border-top:4px solid #28a745}.modal-header[_ngcontent-%COMP%]{padding:30px 30px 20px;text-align:center;background:linear-gradient(135deg,#f8f9fa,#e9ecef)}.modal-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin-bottom:20px;object-fit:contain}.modal-title[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:700;color:#dc3545}.modal-body[_ngcontent-%COMP%]{padding:20px 30px 30px;text-align:center}.modal-message[_ngcontent-%COMP%]{margin:0;font-size:16px;line-height:1.6;color:#6c757d}.modal-footer[_ngcontent-%COMP%]{padding:0}.progress-bar[_ngcontent-%COMP%]{width:100%;height:4px;background-color:#e9ecef;position:relative;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#dc3545,#c82333);width:100%;transform:translate(-100%);animation:_ngcontent-%COMP%_progressAnimation linear forwards}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-50px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}@keyframes _ngcontent-%COMP%_progressAnimation{0%{transform:translate(-100%)}to{transform:translate(0)}}@keyframes _ngcontent-%COMP%_fadeOut{0%{opacity:1}to{opacity:0}}.modal-overlay.closing[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeOut .3s ease-out forwards}"]})};var R=class n{isCollapsed=!1;static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-root"]],standalone:!0,features:[O],decls:2,vars:0,template:function(e,o){e&1&&g(0,"router-outlet")(1,"app-notification-modal")},dependencies:[T,me,ze,Je,Be,S]})};var Ze=[{path:"",pathMatch:"full",redirectTo:"/authentification/login"},{path:"dashboard",loadChildren:()=>import("./chunk-DZEPAHLO.mjs").then(n=>n.DASHBOARD_ROUTES),canActivate:[D]},{path:"hearder",component:Ge},{path:"footer",component:Ye},{path:"authentification",loadChildren:()=>import("./chunk-U5LLBMA2.mjs").then(n=>n.AUTHENTIFICATION_ROUTES)},{path:"items",loadChildren:()=>import("./chunk-SRIWGXST.mjs").then(n=>n.ITEMS_ROUTES),canActivate:[D]},{path:"**",redirectTo:"/authentification/login"}];var qe=[Ne,we,Oe,Re,Le,Ee,Se,Ie,_e,ve,ke,Te,xe,ge,$e,Fe,be,De,Pe,He,Ce,Ue,Ae,ye,Me,je];function lt(n){let t=n,e=Math.floor(Math.abs(n)),o=n.toString().replace(/^[^.]*\.?/,"").length,i=parseInt(n.toString().replace(/^[^e]*(e([-+]?\d+))?/,"$2"))||0;return e===0||e===1?1:i===0&&e!==0&&e%1e6===0&&o===0||!(i>=0&&i<=5)?4:5}var Qe=["fr",[["AM","PM"],void 0,void 0],void 0,[["D","L","M","M","J","V","S"],["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],["di","lu","ma","me","je","ve","sa"]],void 0,[["J","F","M","A","M","J","J","A","S","O","N","D"],["janv.","f\xE9vr.","mars","avr.","mai","juin","juil.","ao\xFBt","sept.","oct.","nov.","d\xE9c."],["janvier","f\xE9vrier","mars","avril","mai","juin","juillet","ao\xFBt","septembre","octobre","novembre","d\xE9cembre"]],void 0,[["av. J.-C.","ap. J.-C."],void 0,["avant J\xE9sus-Christ","apr\xE8s J\xE9sus-Christ"]],1,[6,0],["dd/MM/y","d MMM y","d MMMM y","EEEE d MMMM y"],["HH:mm","HH:mm:ss","HH:mm:ss z","HH:mm:ss zzzz"],["{1} {0}","{1}, {0}","{1} '\xE0' {0}",void 0],[",","\u202F",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0\xA0%","#,##0.00\xA0\xA4","#E0"],"EUR","\u20AC","euro",{ARS:["$AR","$"],AUD:["$AU","$"],BEF:["FB"],BMD:["$BM","$"],BND:["$BN","$"],BYN:[void 0,"\u0440."],BZD:["$BZ","$"],CAD:["$CA","$"],CLP:["$CL","$"],CNY:[void 0,"\xA5"],COP:["$CO","$"],CYP:["\xA3CY"],EGP:[void 0,"\xA3E"],FJD:["$FJ","$"],FKP:["\xA3FK","\xA3"],FRF:["F"],GBP:["\xA3GB","\xA3"],GIP:["\xA3GI","\xA3"],HKD:[void 0,"$"],IEP:["\xA3IE"],ILP:["\xA3IL"],ITL:["\u20A4IT"],JPY:[void 0,"\xA5"],KMF:[void 0,"FC"],LBP:["\xA3LB","\xA3L"],MTP:["\xA3MT"],MXN:["$MX","$"],NAD:["$NA","$"],NIO:[void 0,"$C"],NZD:["$NZ","$"],PHP:[void 0,"\u20B1"],RHD:["$RH"],RON:[void 0,"L"],RWF:[void 0,"FR"],SBD:["$SB","$"],SGD:["$SG","$"],SRD:["$SR","$"],TOP:[void 0,"$T"],TTD:["$TT","$"],TWD:[void 0,"NT$"],USD:["$US","$"],UYU:["$UY","$"],WST:["$WS"],XCD:[void 0,"$"],XPF:["FCFP"],ZMW:[void 0,"Kw"]},"ltr",lt];var ct="@",dt=(()=>{class n{constructor(e,o,i,a,s){this.doc=e,this.delegate=o,this.zone=i,this.animationType=a,this.moduleImpl=s,this._rendererFactoryPromise=null,this.scheduler=u(K,{optional:!0}),this.loadingSchedulerFn=u(ut,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){let e=()=>this.moduleImpl??import("./chunk-PI2CDZEH.mjs").then(i=>i),o;return this.loadingSchedulerFn?o=this.loadingSchedulerFn(e):o=e(),o.catch(i=>{throw new j(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:a})=>{this._engine=i(this.animationType,this.doc);let s=new a(this.delegate,this._engine,this.zone);return this.delegate=s,s})}createRenderer(e,o){let i=this.delegate.createRenderer(e,o);if(i.\u0275type===0)return i;typeof i.throwOnSyntheticProps=="boolean"&&(i.throwOnSyntheticProps=!1);let a=new F(i);return o?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(s=>{let r=s.createRenderer(e,o);a.use(r),this.scheduler?.notify(10)}).catch(s=>{a.use(i)}),a}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}static{this.\u0275fac=function(o){W()}}static{this.\u0275prov=l({token:n,factory:n.\u0275fac})}}return n})(),F=class{constructor(t){this.delegate=t,this.replay=[],this.\u0275type=1}use(t){if(this.delegate=t,this.replay!==null){for(let e of this.replay)e(t);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}get destroyNode(){return this.delegate.destroyNode}appendChild(t,e){this.delegate.appendChild(t,e)}insertBefore(t,e,o,i){this.delegate.insertBefore(t,e,o,i)}removeChild(t,e,o){this.delegate.removeChild(t,e,o)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,o,i){this.delegate.setAttribute(t,e,o,i)}removeAttribute(t,e,o){this.delegate.removeAttribute(t,e,o)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,o,i){this.delegate.setStyle(t,e,o,i)}removeStyle(t,e,o){this.delegate.removeStyle(t,e,o)}setProperty(t,e,o){this.shouldReplay(e)&&this.replay.push(i=>i.setProperty(t,e,o)),this.delegate.setProperty(t,e,o)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,o){return this.shouldReplay(e)&&this.replay.push(i=>i.listen(t,e,o)),this.delegate.listen(t,e,o)}shouldReplay(t){return this.replay!==null&&t.startsWith(ct)}},ut=new L("");function et(n="animations"){return Z("NgAsyncAnimations"),V([{provide:X,useFactory:(t,e,o)=>new dt(t,e,o,n),deps:[oe,ce,B]},{provide:J,useValue:n==="noop"?"NoopAnimations":"BrowserAnimations"}])}var I=class n{authService=u(E);router=u(fe);modalService=u(f);EXCLUDED_URLS=["/api/login","/api/register","/api/password/send-token","/api/password/reset","/api/status"];intercept(t,e){if(console.log("\u{1F50D} INTERCEPTOR: Requ\xEAte vers",t.url),!this.shouldAddToken(t.url))return console.log("\u26AA INTERCEPTOR: Pas de token requis pour",t.url),e.handle(t);if(!this.authService.isSessionValid())return console.log("\u274C INTERCEPTOR: Session expir\xE9e"),this.authService.forceLogout(),e.handle(t);let i=this.authService.getToken();if(console.log("\u{1F50D} INTERCEPTOR: Valeur du token:",i||"Aucun token"),!i)return console.log("\u274C INTERCEPTOR: Aucun token valide disponible"),this.authService.forceLogout(),e.handle(t);if(console.log("\u2705 INTERCEPTOR: Token valide trouv\xE9 (longueur:",i.length,")"),!this.isValidJWT(i))return console.log("\u274C INTERCEPTOR: Format JWT invalide"),this.authService.forceLogout(),e.handle(t);let a={Authorization:`Bearer ${i}`,Accept:"application/json"};t.body instanceof FormData||(a["Content-Type"]="application/json");let s=t.clone({setHeaders:a});return console.log("\u{1F512} INTERCEPTOR: Headers d'authentification ajout\xE9s"),e.handle(s).pipe(U(r=>(console.log("\u{1F4A5} INTERCEPTOR ERROR:",r.status,r.message),r.status===500&&r.error?.message?.includes("token could not be parsed")?(console.log("\u{1F534} INTERCEPTOR: Erreur parsing token - token corrompu"),this.authService.diagnosticToken(),this.authService.forceLogout(),d(()=>new Error("Token invalide - Veuillez vous reconnecter"))):r.status===401?(console.log("\u{1F534} INTERCEPTOR: Token expir\xE9 ou invalide (401)"),this.authService.forceLogout(),d(()=>new Error("Session expir\xE9e - Veuillez vous reconnecter"))):r.status===403?(console.log("\u{1F534} INTERCEPTOR: Acc\xE8s refus\xE9 (403)"),r.error?.status_code===403&&r.error?.success===!1&&r.error?.message?.includes("inactif ou suspendu")?(console.log("\u{1F534} INTERCEPTOR: Compte inactif/suspendu d\xE9tect\xE9 - D\xE9connexion forc\xE9e"),this.handleAccountSuspension(),d(()=>new Error("Votre compte est inactif ou suspendu. Veuillez contacter l'administrateur."))):d(()=>new Error("Acc\xE8s refus\xE9"))):r.status===0||r.message?.includes("Network")||r.message?.includes("timeout")||r.message?.includes("connection")||r.error instanceof ProgressEvent?(console.log("\u{1F534} INTERCEPTOR: Erreur de connexion API d\xE9tect\xE9e"),this.handleConnectionError(),d(()=>new Error("Connexion au serveur impossible. Veuillez v\xE9rifier votre connexion r\xE9seau."))):d(()=>r))))}isValidJWT(t){if(!t||typeof t!="string")return!1;let e=t.split(".");if(e.length!==3)return!1;try{for(let o of e){if(!o||o.length===0)return!1;atob(o.replace(/-/g,"+").replace(/_/g,"/"))}return!0}catch(o){return console.log("\u274C INTERCEPTOR: Erreur validation JWT:",o),!1}}shouldAddToken(t){return!this.EXCLUDED_URLS.some(o=>t.includes(o))}handleAccountSuspension(){console.log("\u{1F6A8} INTERCEPTOR: Gestion de la suspension de compte"),this.authService.resetUserState(),this.modalService.showAccountSuspendedModal(),setTimeout(()=>{this.modalService.hideModal(),this.router.navigate(["/authentification/login"]),console.log("\u{1F504} INTERCEPTOR: Redirection vers /authentification/login")},4e3)}handleConnectionError(){console.log("\u{1F6A8} INTERCEPTOR: Gestion des erreurs de connexion API"),this.authService.resetUserState(),this.modalService.showConnectionErrorModal(),setTimeout(()=>{this.modalService.hideModal(),this.router.navigate(["/authentification/login"]),console.log("\u{1F504} INTERCEPTOR: Redirection vers /authentification/login apr\xE8s erreur de connexion")},4e3)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=l({token:n,factory:n.\u0275fac})};var b=class n{intercept(t,e){return e.handle(t).pipe(H(o=>{if(o instanceof ae){let i=this.decodeUnicodeInObject(o.body);return console.log("\u{1F30D} Unicode Interceptor - R\xE9ponse d\xE9cod\xE9e pour:",t.url),o.clone({body:i})}return o}))}decodeUnicodeString(t){if(!t||typeof t!="string")return t;try{let e=t.replace(/\\u([\dA-Fa-f]{4})/g,(i,a)=>String.fromCharCode(parseInt(a,16)));e=e.replace(/&#(\d+);/g,(i,a)=>String.fromCharCode(a));let o={"&eacute;":"\xE9","&egrave;":"\xE8","&ecirc;":"\xEA","&agrave;":"\xE0","&acirc;":"\xE2","&ccedil;":"\xE7","&ocirc;":"\xF4","&ugrave;":"\xF9","&ucirc;":"\xFB","&icirc;":"\xEE","&ntilde;":"\xF1","&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};for(let[i,a]of Object.entries(o))e=e.replace(new RegExp(i,"g"),a);try{e.includes("%")&&(e=decodeURIComponent(e))}catch{}return e}catch(e){return console.warn("Erreur d\xE9codage Unicode pour:",t,e),t}}decodeUnicodeInObject(t){if(t==null)return t;if(typeof t=="string")return this.decodeUnicodeString(t);if(Array.isArray(t))return t.map(e=>this.decodeUnicodeInObject(e));if(typeof t=="object"){let e={};for(let o in t)if(Object.prototype.hasOwnProperty.call(t,o)){let i=this.decodeUnicodeString(o);e[i]=this.decodeUnicodeInObject(t[o])}return e}return t}static \u0275fac=function(e){return new(e||n)};static \u0275prov=l({token:n,factory:n.\u0275fac})};ne(Qe);var tt={providers:[ee({eventCoalescing:!0}),he(Ze),ue(),Ve(qe),We(Ke),z(Xe),et(),se(le()),E,{provide:w,useClass:I,multi:!0},{provide:w,useClass:b,multi:!0}]};var pt={providers:[pe()]},ot=te(tt,pt);var mt=()=>de(R,ot),bo=mt;export{bo as a};
