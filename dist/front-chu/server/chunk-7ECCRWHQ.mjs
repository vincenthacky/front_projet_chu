import './polyfills.server.mjs';
import{a as s}from"./chunk-KHW4IOFH.mjs";import{c as o,g as _}from"./chunk-UXVSRWVF.mjs";import{da as c,ia as u}from"./chunk-OQNIVP4F.mjs";import{a as m,b as p}from"./chunk-5XUXGTUW.mjs";var d=class i{constructor(e){this.http=e}apiUrl=`${s.apiUrl}/paiements`;createPaiement(e){let t={id_souscription:e.id_souscription,mode_paiement:e.mode_paiement,montant_paye:e.montant_paye.toString(),date_paiement_effectif:e.date_paiement_effectif};return e.reference_paiement&&e.reference_paiement.trim()!==""&&(t.reference_paiement=e.reference_paiement),e.commentaire_paiement&&e.commentaire_paiement.trim()!==""&&(t.commentaire_paiement=e.commentaire_paiement),console.log("\u{1F4E4} Envoi paiement \xE0 l'API:",t),console.log("\u{1F517} URL:",this.apiUrl),this.http.post(this.apiUrl,t)}getMesPaiements(e){let t=new o;return e&&(e.page&&(t=t.set("page",e.page.toString())),e.per_page&&(t=t.set("per_page",e.per_page.toString())),e.id_souscription&&(t=t.set("id_souscription",e.id_souscription.toString())),e.statut_versement&&(t=t.set("statut_versement",e.statut_versement)),e.mode_paiement&&(t=t.set("mode_paiement",e.mode_paiement)),e.date_debut&&(t=t.set("date_debut",e.date_debut)),e.date_fin&&(t=t.set("date_fin",e.date_fin)),e.search&&(t=t.set("search",e.search))),console.log("\u{1F4E4} Appel API getPaiements avec filtres:",e),console.log("\u{1F517} URL compl\xE8te:",`${this.apiUrl}?${t.toString()}`),this.http.get(this.apiUrl,{params:t})}getPaiementsForUser(e){let t=`${s.apiUrl}/paiements/utilisateur`,n=new o;return e&&(e.page&&(n=n.set("page",e.page.toString())),e.per_page&&(n=n.set("per_page",e.per_page.toString())),e.id_souscription&&(n=n.set("id_souscription",e.id_souscription.toString())),e.statut_versement&&(n=n.set("statut_versement",e.statut_versement)),e.mode_paiement&&(n=n.set("mode_paiement",e.mode_paiement)),e.date_debut&&(n=n.set("date_debut",e.date_debut)),e.date_fin&&(n=n.set("date_fin",e.date_fin)),e.search&&(n=n.set("search",e.search))),console.log("\u{1F4E4} Appel API getPaiementsForUser avec filtres:",e),console.log("\u{1F517} URL compl\xE8te:",`${t}?${n.toString()}`),this.http.get(t,{params:n})}getPaiementsBySubscription(e,t){let n=p(m({},t),{id_souscription:e});return console.log("\u{1F4E4} Appel API getPaiementsBySubscription pour souscription:",e),this.getMesPaiements(n)}parseAmount(e){if(typeof e=="number")return e;if(!e)return 0;let t=e.toString().replace(/[^\d.-]/g,"");return parseFloat(t)||0}formatCurrency(e){return new Intl.NumberFormat("fr-FR").format(e)+" FCFA"}formatDate(e){if(!e)return"Date non disponible";try{let t=new Date(e);return isNaN(t.getTime())?"Date invalide":t.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return console.error("Erreur formatage date:",t),"Date non disponible"}}getPaymentStatusColor(e){switch(e?.toLowerCase()){case"paye_a_temps":return"#10b981";case"paye_en_retard":return"#f59e0b";case"paiement_partiel":return"#3b82f6";default:return"#6b7280"}}getPaymentStatusLabel(e){switch(e?.toLowerCase()){case"paye_a_temps":return"Pay\xE9 \xE0 temps";case"paye_en_retard":return"Pay\xE9 en retard";case"paiement_partiel":return"paiement_partiel";default:return e||"Inconnu"}}getPaymentModeLabel(e){switch(e?.toLowerCase()){case"cheque":return"Ch\xE8que";case"especes":return"Esp\xE8ces";case"virement":return"Virement bancaire";case"carte":return"Carte bancaire";case"mobile":return"Paiement mobile";case"mandat":return"Mandat";default:return e||"Non sp\xE9cifi\xE9"}}calculatePaymentStats(e){let t=e.reduce((r,a)=>r+this.parseAmount(a.montant_paye),0),n=e.reduce((r,a)=>r+this.parseAmount(a.montant_versement_prevu),0),g=e.reduce((r,a)=>r+this.parseAmount(a.penalite_appliquee),0);return{totalPaye:t,totalPrevu:n,nombrePaiements:e.length,montantMoyen:e.length>0?t/e.length:0,penalitesTotales:g}}static \u0275fac=function(t){return new(t||i)(u(_))};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};export{d as a};
