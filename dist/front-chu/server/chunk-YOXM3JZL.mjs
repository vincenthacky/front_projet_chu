import './polyfills.server.mjs';
import{a as h}from"./chunk-DVAA3UE3.mjs";import{e as l}from"./chunk-LI7RJ6PT.mjs";import{J as d,da as c,ja as n,r as u}from"./chunk-OQNIVP4F.mjs";var f=class a{authService=n(h);router=n(l);canActivate(o,e){return this.authService.isAuthenticated$.pipe(d(1),u(t=>{console.log("\u{1F512} Guard - V\xE9rification acc\xE8s pour:",e.url),console.log("\u{1F512} Guard - Utilisateur authentifi\xE9:",t);let i=e.url;if(this.isAuthRoute(i))return t?(console.log("\u{1F504} Guard - D\xE9j\xE0 connect\xE9, redirection depuis login vers dashboard"),this.redirectToDashboard(),!1):(console.log("\u2705 Guard - Acc\xE8s autoris\xE9 aux pages d'authentification"),!0);if(!t)return console.log("\u274C Guard - Non authentifi\xE9, redirection vers login"),this.router.navigate(["/authentification/login"],{queryParams:{returnUrl:e.url}}),!1;let r=this.authService.getCurrentUser();if(!r)return console.log("\u274C Guard - Pas d'utilisateur, redirection vers login"),this.router.navigate(["/authentification/login"]),!1;if(r.type!=="user"&&r.type!=="superAdmin")return console.error("\u274C Guard - R\xF4le non autoris\xE9:",r.type),this.authService.forceLogout(),!1;console.log("\u{1F464} Guard - Utilisateur:",{nom:r.nom,type:r.type,est_administrateur:r.est_administrateur});let s=this.authService.isAdmin();return console.log("\u{1F6E1}\uFE0F Guard - Est admin?",s),i.includes("/dashboard/admin")?s?(console.log("\u2705 Guard - Acc\xE8s admin autoris\xE9"),!0):(console.log("\u{1F504} Guard - Pas admin, redirection vers user dashboard"),this.router.navigate(["/dashboard/user/details"]),!1):i.includes("/dashboard/user")?s?(console.log("\u{1F504} Guard - Admin d\xE9tect\xE9, redirection vers admin dashboard"),this.router.navigate(["/dashboard/admin/details"]),!1):(console.log("\u2705 Guard - Acc\xE8s user autoris\xE9"),!0):i==="/dashboard"||i==="/dashboard/"?(this.redirectToDashboard(),!1):(console.log("\u2705 Guard - Acc\xE8s g\xE9n\xE9ral autoris\xE9"),!0)}))}isAuthRoute(o){return["/authentification/login","/authentification/register","/authentification/forgot-password","/authentification/reset-password"].some(t=>o.startsWith(t))}redirectToDashboard(){this.authService.getCurrentUser()&&(this.authService.isAdmin()?(console.log("\u{1F504} Guard - Admin, redirection vers admin dashboard"),this.router.navigate(["/dashboard/admin/details"])):(console.log("\u{1F504} Guard - User, redirection vers user dashboard"),this.router.navigate(["/dashboard/user/details"])))}static \u0275fac=function(e){return new(e||a)};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{f as a};
