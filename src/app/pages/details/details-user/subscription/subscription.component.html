<div class="subscription-wrapper">
    <!-- En-t√™te -->
    <div class="header-section">
        <h1 class="main-title">
            <i class="fas fa-map-marked-alt"></i>
            Mes Souscriptions
        </h1>
        <p class="subtitle">G√©rez et suivez tous vos terrains en temps r√©el</p>
    </div>
  
    <!-- Contr√¥les -->
    <div class="controls-section">
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input 
                type="text" 
                class="search-input" 
                placeholder="Rechercher par ID, terrain, montant..."
                [(ngModel)]="searchTerm"
                (input)="onSearchChange()"
            >
        </div>
        <div class="filters-section">
            <select class="filter-select" [(ngModel)]="statusFilter" (change)="onStatusFilterChange()">
                <option value="">Tous les statuts</option>
                <option value="en-cours">En cours</option>
                <option value="en-retard">En retard</option>
                <option value="termine">Termin√©</option>
            </select>
            <select class="filter-select" [(ngModel)]="terrainFilter" (change)="onTerrainFilterChange()">
                <option value="">Toutes les surfaces</option>
                <option value="250">250m¬≤</option>
                <option value="500">500m¬≤</option>
            </select>
            <button class="refresh-btn" (click)="refreshData()" [disabled]="loading">
                <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
                {{ loading ? 'Chargement...' : 'Actualiser' }}
            </button>
        </div>
    </div>
  
    <!-- Statistiques -->
    <div class="stats-bar">
        <div class="stat-card">
            <div class="stat-number">{{ totalSubscriptions }}</div>
            <div class="stat-label">Total Souscriptions</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ formatAmount(totalAmount) }}</div>
            <div class="stat-label">Montant Total</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ formatAmount(totalPaid) }}</div>
            <div class="stat-label">D√©j√† Pay√©</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ formatAmount(totalRemaining) }}</div>
            <div class="stat-label">Reste √† Payer</div>
        </div>
    </div>
  
    <!-- Tableau -->
    <div class="table-responsive desktop-only">
        <!-- Titre mobile pour le tableau -->
        <div class="mobile-table-title">üìã Liste des Souscriptions</div>
        
        <!-- Indicateur de d√©filement pour mobile -->
        <div class="table-scroll-indicator">
            <i class="fas fa-arrow-right"></i>
            Faites d√©filer horizontalement pour voir plus
        </div>

        <div class="table-container">
            <table class="modern-table">
                <thead class="table-header">
                    <tr>
                        <th>ID</th>
                        <th>Terrain</th>
                        <th>Prix Total</th>
                        <th>Montant Pay√©</th>
                        <th>Reste √† Payer</th>
                        <th>Date D√©but</th>
                        <th>Prochain Paiement</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr class="table-row" *ngFor="let subscription of paginatedData; trackBy: trackByFn">
                        <td class="table-cell">
                            <div class="subscription-id">{{ subscription.id }}</div>
                        </td>
                        <td class="table-cell">
                            <div class="terrain-info">
                                <div class="terrain-icon">
                                    <i class="fas fa-map"></i>
                                </div>
                                <div class="terrain-details">
                                    <h4>{{ subscription.terrain }}</h4>
                                    <div class="terrain-surface">{{ subscription.surface }}m¬≤</div>
                                </div>
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="price-display">{{ formatAmount(subscription.prixTotal) }}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" [style.width.%]="subscription.progression"></div>
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="amount-paid">{{ formatAmount(subscription.montantPaye) }}</div>
                        </td>
                        <td class="table-cell">
                            <div class="amount-remaining">{{ formatAmount(subscription.resteAPayer) }}</div>
                        </td>
                        <td class="table-cell">
                            <div class="date-display">{{ formatDate(subscription.dateDebut) }}</div>
                        </td>
                        <td class="table-cell">
                            <div class="next-payment">
                                <i class="fas fa-calendar-alt"></i>
                                {{ formatDate(subscription.prochainPaiement) }}
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="status-badge" [ngClass]="getStatusClass(subscription.statut)">
                                <i class="fas" [ngClass]="getStatusIcon(subscription.statut)"></i>
                                {{ getStatusLabel(subscription.statut) }}
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="action-buttons">
                                <button class="action-btn btn-view" nz-button [nzType]="'primary'" (click)="showModal(subscription)" title="Voir plus">
                                    <i class="fas fa-eye"></i>
                                    <span class="btn-text">Voir</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <!-- Ligne de chargement -->
                    <tr *ngIf="loading">
                        <td colspan="9" class="loading-cell">
                            <div class="loading-content">
                                <i class="fas fa-spinner loading-spinner"></i>
                                <span class="loading-text">Chargement des souscriptions...</span>
                            </div>
                        </td>
                    </tr>
                    <!-- Ligne vide si aucune donn√©e -->
                    <tr *ngIf="!loading && paginatedData.length === 0">
                        <td colspan="9" class="no-results">
                            <i class="fas fa-search"></i>
                            <h3>Aucune souscription trouv√©e</h3>
                            <p>Essayez de modifier vos crit√®res de recherche</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination ng-zorro CORRIG√âE -->
        <div class="pagination-container">
            <nz-pagination
                [nzTotal]="totalItems"
                [nzPageSize]="itemsPerPage"
                [nzPageIndex]="currentPage"
                [nzShowSizeChanger]="true"
                [nzShowQuickJumper]="true"
                [nzShowTotal]="totalTemplate"
                [nzPageSizeOptions]="[10, 20, 50, 100]"
                (nzPageIndexChange)="onPageChange($event)"
                (nzPageSizeChange)="onPageSizeChange($event)">
            </nz-pagination>

            <ng-template #totalTemplate let-total let-range="range">
            </ng-template>
        </div>
    </div>
</div>
  
<!-- Modal Paiements avec en-t√™te bleue -->
<nz-modal 
    [(nzVisible)]="isVisible" 
    [nzFooter]="null" 
    (nzOnCancel)="handleCancel()" 
    [nzWidth]="400"
    nzWrapClassName="custom-modal">
    <div class="modal-header-blue" *nzModalTitle>
        <div class="modal-header-content">
            <i class="fas fa-credit-card modal-icon"></i>
            <span class="modal-title-text">Derniers paiements</span>
        </div>
    </div>
    <ng-container *nzModalContent>
        <div class="modal-content">
            <div class="subscription-info">
                <div class="subscription-title">
                    <i class="fas fa-map-marked-alt"></i>
                    Souscription {{ selectedSubscriptionId }}
                </div>
                <div class="terrain-badge">Terrain s√©lectionn√©</div>
            </div>

            <div class="payments-section">
                <div class="payments-title">
                    <i class="fas fa-history"></i>
                    Historique des paiements
                </div>
                
                <div class="payments-list" *ngIf="lastFivePayments.length > 0">
                    <div class="payment-item" *ngFor="let payment of lastFivePayments">
                        <div class="payment-date">
                            <i class="fas fa-calendar-alt"></i>
                            {{ payment.date }}
                        </div>
                        <div class="payment-amount">{{ payment.amount | number }} FCFA</div>
                    </div>
                </div>
                
                <div class="no-payments" *ngIf="lastFivePayments.length === 0">
                    <i class="fas fa-info-circle"></i>
                    Aucun paiement trouv√©
                </div>
            </div>

            <div class="modal-actions">
                <button nz-button nzType="default" class="cancel-btn" (click)="handleCancel()">
                    <i class="fas fa-times"></i>
                    Annuler
                </button>
                <button nz-button nzType="primary" class="details-btn" (click)="handleOk()">
                    <i class="fas fa-eye"></i>
                    Voir d√©tails
                </button>
            </div>
        </div>
    </ng-container>
</nz-modal>