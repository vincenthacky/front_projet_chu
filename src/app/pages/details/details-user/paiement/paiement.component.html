<div class="payment-container">
  <!-- Header avec statistiques -->
  <div class="header-section">
    <h2 class="main-title">
      <i class="fas fa-calendar-check"></i>
      Échéancier de Paiement
    </h2>
    
    <!-- Cards statistiques -->
    <div class="stats-grid">
      <div class="stat-card total-card">
        <div class="stat-icon">
          <i class="fas fa-list-ol"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ getTotalMensualites() }}</div>
          <div class="stat-label">Total mensualités</div>
        </div>
      </div>
      
      <div class="stat-card success-card">
        <div class="stat-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ getPayeATemps() }}</div>
          <div class="stat-label">Payé à temps</div>
        </div>
      </div>
      
      <div class="stat-card warning-card">
        <div class="stat-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ getEnRetard() }}</div>
          <div class="stat-label">En retard</div>
        </div>
      </div>
      
      <div class="stat-card pending-card">
        <div class="stat-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ getEnAttente() }}</div>
          <div class="stat-label">En attente</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Tags -->
  <div class="status-section">
    <div class="status-tags">
      <nz-tag nzColor="green" class="status-tag" *ngIf="getPayeATemps() > 0">
        <i class="fas fa-trophy"></i>
        Paiements conformes - Éligible aux récompenses
      </nz-tag>
      <nz-tag nzColor="orange" class="status-tag" *ngIf="getEnRetard() > 0">
        <i class="fas fa-exclamation-circle"></i>
        Paiements en retard - Attention à la régularité
      </nz-tag>
      <nz-tag nzColor="red" class="status-tag" *ngIf="getEnAttente() > 0">
        <i class="fas fa-times-circle"></i>
        Paiements non conformes - Non éligible aux récompenses
      </nz-tag>
    </div>
  </div>

  <!-- Montant total et pénalités -->
  <div class="summary-cards">
    <div class="summary-card amount-card">
      <div class="summary-icon">
        <i class="fas fa-coins"></i>
      </div>
      <div class="summary-content">
        <div class="summary-value">{{ getMontantTotalPaye() }}</div>
        <div class="summary-label">Montant total payé</div>
      </div>
    </div>
    
    <div class="summary-card penalty-card">
      <div class="summary-icon">
        <i class="fas fa-ban"></i>
      </div>
      <div class="summary-content">
        <div class="summary-value">{{ getTotalPenalites() }}</div>
        <div class="summary-label">Total pénalités</div>
      </div>
    </div>
  </div>

  <!-- Table responsive -->
  <div class="table-section">
    <div class="table-header">
      <h3 class="table-title">
        <i class="fas fa-table"></i>
        Détail des paiements ({{ getNombrePaiements() }} paiements)
      </h3>
    </div>
    
    <div class="responsive-table-container">
      <nz-table 
        [nzData]="payments" 
        [nzBordered]="true" 
        [nzSize]="'small'" 
        [nzScroll]="{ x: '800px' }"
        [nzLoading]="loading">
        <thead>
          <tr>
            <th nzWidth="50px">#</th>
            <th nzWidth="120px">Montant prévu</th>
            <th nzWidth="100px">Date limite</th>
            <th nzWidth="100px">Date paiement</th>
            <th nzWidth="120px">Montant payé</th>
            <th nzWidth="80px">Mode</th>
            <th nzWidth="100px">Référence</th>
            <th nzWidth="120px">Statut</th>
            <th nzWidth="100px">Pénalité</th>
            <th nzWidth="150px">Commentaire</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of payments; trackBy: trackByPayment; let i = index"
              [class]="getRowClass(payment)">
            <td>
              <div class="cell-content">
                <span class="mensualite-badge">{{ payment.numero_mensualite }}</span>
              </div>
            </td>
            <td>
              <div class="cell-content amount-cell">
                <i class="fas fa-coins cell-icon"></i>
                {{ formatNumber(payment.montant_prevu) }}
              </div>
            </td>
            <td>
              <div class="cell-content date-cell">
                <i class="fas fa-calendar cell-icon"></i>
                {{ payment.date_limite }}
              </div>
            </td>
            <td>
              <div class="cell-content date-cell">
                <i class="fas fa-check cell-icon success" *ngIf="payment.date !== '-'"></i>
                <i class="fas fa-minus cell-icon muted" *ngIf="payment.date === '-'"></i>
                {{ payment.date }}
              </div>
            </td>
            <td>
              <div class="cell-content amount-cell paid">
                <i class="fas fa-money-bill-wave cell-icon"></i>
                {{ formatNumber(payment.amount) }}
              </div>
            </td>
            <td>
              <div class="cell-content">
                <span class="mode-badge" *ngIf="payment.mode_paiement !== '-'">{{ payment.mode_paiement }}</span>
                <span class="muted-text" *ngIf="payment.mode_paiement === '-'">-</span>
              </div>
            </td>
            <td>
              <div class="cell-content reference-cell">
                <span class="reference-text" *ngIf="payment.reference_paiement">{{ payment.reference_paiement }}</span>
                <span class="muted-text" *ngIf="!payment.reference_paiement">-</span>
              </div>
            </td>
            <td>
              <div class="cell-content">
                <nz-tag 
                  [nzColor]="getStatusColor(payment)" 
                  class="status-tag-table">
                  <i class="fas" [class]="getStatusIcon(payment)"></i>
                  {{ getStatusLabel(payment) }}
                </nz-tag>
              </div>
            </td>
            <td>
              <div class="cell-content penalty-cell">
                <span class="penalty-amount" *ngIf="payment.penalite_appliquee > 0">
                  <i class="fas fa-exclamation-triangle"></i>
                  {{ formatNumber(payment.penalite_appliquee) }}
                </span>
                <span class="muted-text" *ngIf="payment.penalite_appliquee === 0">-</span>
              </div>
            </td>
            <td>
              <div class="cell-content comment-cell">
                <span class="comment-text" *ngIf="payment.commentaire">{{ payment.commentaire }}</span>
                <span class="muted-text" *ngIf="!payment.commentaire">-</span>
              </div>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>
</div>

<!-- Loading state -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner">
    <i class="fas fa-spinner fa-spin"></i>
  </div>
  <div class="loading-text">Chargement des paiements...</div>
</div>