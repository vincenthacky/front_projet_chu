<h2 class="reclamation-title">Mes réclamations</h2>

<div class="reclamation-grid">
  <div class="reclamation-col reclamation-col-list">
    <!-- Liste des réclamations sous forme de cartes -->
    <div class="reclamation-card-list">
      <div class="reclamation-card" *ngFor="let r of reclamations">
        <div class="reclamation-card-header">
          <div>
            <strong>{{ r.titre }}</strong>
            <br>
            <small>Soumise le {{ r.date_reclamation | date:'dd MMM yyyy' }}</small>
          </div>
          <span class="status-badge"
                [ngClass]="{
                  'status-success': r.statut.libelle_statut_reclamation === 'Résolue' || r.id_statut_reclamation === 4,
                  'status-warning': r.statut.libelle_statut_reclamation === 'En cours' || r.id_statut_reclamation === 2,
                  'status-danger': r.statut.libelle_statut_reclamation === 'Nouvelle' || r.id_statut_reclamation === 3 || r.id_statut_reclamation === 6
                }">
            {{ r.statut.libelle_statut_reclamation }}
          </span>
        </div>
        <div class="reclamation-card-body">
          <div class="reclamation-info">
            <div><b>Souscription ID :</b> {{ r.id_souscription }}</div>
            <div><b>Type :</b> {{ getTypeLabel(r.type_reclamation) }}</div>
            <div><b>Priorité :</b> <span [ngClass]="{
              'prio-haute': r.priorite === 'haute',
              'prio-basse': r.priorite === 'basse',
              'prio-normale': r.priorite === 'normale',
              'prio-urgente': r.priorite === 'urgente'
            }">{{ getPriorityLabel(r.priorite) }}</span></div>
          </div>
          <div class="reclamation-desc">{{ r.description }}</div>
          <div class="reclamation-admin" *ngIf="r.reponse_admin">
            <b>Réponse admin :</b> {{ r.reponse_admin }}<br>
            <small>Date réponse : {{ r.date_reponse | date:'dd/MM/yyyy' }}</small>
          </div>
          <div class="reclamation-resol" *ngIf="r.date_resolution">
            <b>Date de résolution :</b> {{ r.date_resolution | date:'dd/MM/yyyy' }}
          </div>
          <div class="reclamation-sat" *ngIf="r.satisfaction_client">
            <b>Satisfaction :</b> <span class="satisfaction">{{ r.satisfaction_client }}/5</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Message si pas de réclamations -->
 <!-- Message si pas de réclamations - VERSION AMÉLIORÉE -->
<div *ngIf="reclamations.length === 0 && !isLoadingReclamations" class="no-data">
  <nz-empty 
  nzNotFoundImage="https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg"
  nzNotFoundContent="Aucune réclamation trouvé">
</nz-empty>
</div>

<!-- État de chargement -->
<div *ngIf="isLoadingReclamations" class="loading-state">
  <div class="loading-content">
    <nz-spin nzSize="large">
      <div class="loading-text">Chargement de vos réclamations...</div>
    </nz-spin>
  </div>
</div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalReclamations > pageSize">
      <nz-pagination 
        [(nzPageIndex)]="currentPage"
        [nzTotal]="totalReclamations"
        [nzPageSize]="pageSize"
        nzShowSizeChanger="false"
        nzShowQuickJumper="false" 
        nzSize="small"
        (nzPageIndexChange)="onPageChange($event)">
      </nz-pagination>
    </div>
  </div>
  
  <div class="reclamation-col reclamation-col-form">
    <!-- Formulaire de nouvelle réclamation -->
    <div class="reclamation-form">
      <h4>Nouvelle réclamation</h4>
      <form [formGroup]="form" (ngSubmit)="handleOk()" nz-form>
        <div class="form-group">
          <label for="souscription">Souscription</label>
          <nz-select formControlName="souscription" id="souscription" nzPlaceHolder="Sélectionner une souscription">
            <nz-option *ngFor="let s of souscription" [nzValue]="s.id_souscription" [nzLabel]="s.terrain.libelle"></nz-option>
          </nz-select>
        </div>
        <div class="form-group">
          <label for="titre">Titre</label>
          <input nz-input formControlName="titre" id="titre" maxlength="255" required placeholder="Sujet de la réclamation" />
        </div>
        <div class="form-group">
          <label for="type_reclamation">Type de réclamation</label>
          <nz-select formControlName="type_reclamation" id="type_reclamation" nzPlaceHolder="Type de réclamation">
            <nz-option *ngFor="let t of typeOptions" [nzValue]="t.value" [nzLabel]="t.label"></nz-option>
          </nz-select>
        </div>
        <div class="form-group">
          <label for="description">Description</label>
          <textarea nz-input formControlName="description" id="description" rows="4" required placeholder="Décrivez votre problème"></textarea>
        </div>
        <div class="form-group">
          <label for="priorite">Priorité</label>
          <nz-select formControlName="priorite" id="priorite">
            <nz-option *ngFor="let p of prioriteOptions" [nzValue]="p.value" [nzLabel]="p.label"></nz-option>
          </nz-select>
        </div>
        <div class="form-group">
          <label for="document">Document</label>
          <input type="file" id="document" (change)="onFileSelected($event)" accept=".pdf,.doc,.docx,.jpg,.png" />
        </div>
        <button nz-button nzType="primary" class="btn" type="submit">Envoyer la réclamation</button>
      </form>
    </div>
  </div>
</div>