<!-- evenements.component.html - Version avec pagination -->
<section class="content">
  <div class="container-fluid">
    <h6 class="evenements-title">
      <i class="fas fa-map-marked-alt"></i>
      Suivi du Projet & Avancement des Terrains
    </h6>

    <!-- Loading indicator -->
    <div *ngIf="loading" class="text-center p-4">
      <i class="fas fa-spinner fa-spin"></i> Chargement des événements...
    </div>

    <!-- Section Mes Souscriptions -->
    <div class="souscription-section" *ngIf="!loading">
      <div class="section-header">
        <div class="section-title">
          <i class="fas fa-user-check"></i> Mes Souscriptions
        </div>
        <div class="section-subtitle">Suivi personnalisé de vos terrains</div>
      </div>

      <div class="timeline" *ngIf="evenementsSouscription.length > 0">
        <!-- Label de date pour les souscriptions -->
        <div class="time-label blue">
          <span>{{ getDateRangeLabel(evenementsSouscription) }} - Mes Projets</span>
        </div>

        <!-- Boucle sur les événements de souscription paginés -->
        <div *ngFor="let event of getPaginatedEvents(); let i = index">
          <i class="fas" 
             [ngClass]="getEventIcon(event.type_evenement)" 
             [class]="getEventColor(event.type_evenement, event.niveau_avancement_pourcentage)"
             [style.background-color]="event.type_evenement.couleur_affichage"></i>
          
          <div class="timeline-item">
            <span class="time">
              <i class="fas fa-clock"></i> 
              {{ getEventStatus(event.niveau_avancement_pourcentage) }}
            </span>
            
            <h3 class="timeline-header">
              <a href="#" (click)="onEventClick(event)">{{ event.titre }}</a>
              <span *ngIf="event.lieu"> - {{ event.lieu }}</span>
            </h3>

            <div class="timeline-body">
              {{ event.description }}
              <br><br>
              <img *ngFor="let photo of getEventPhotos(event)" 
                   [src]="photo" 
                   [alt]="event.titre"
                   (click)="openPhotoModal(photo)"
                   style="cursor: pointer; max-width: 150px; max-height: 100px; margin: 5px;">
            </div>

            <div class="evenement-info">
              <span class="tag" [ngClass]="getTypeClass(event.type_evenement.libelle_type_evenement)">
                {{ event.type_evenement.libelle_type_evenement }}
              </span>
              <span class="tag etape" *ngIf="event.etape_actuelle">{{ event.etape_actuelle }}</span>
              <span class="tag">{{ event.lieu }}</span>
              <span class="tag" [ngClass]="getStatutClass(event.statut_evenement)">
                {{ event.badge_statut.libelle }}
              </span>
            </div>

            <div class="evenement-dates">
              <strong>Date :</strong> {{ event.date_debut_evenement | date:'dd/MM/yyyy' }}
              <span *ngIf="event.date_debut_evenement !== event.date_fin_evenement">
                - {{ event.date_fin_evenement | date:'dd/MM/yyyy' }}
              </span>
            </div>

            <!-- Info terrain si disponible -->
            <div class="terrain-info" *ngIf="event.souscription && event.souscription.terrain">
              <strong>Terrain:</strong> {{ event.souscription.terrain.libelle }}
              ({{ event.souscription.terrain.superficie }}m²)
              - {{ event.souscription.terrain.localisation }}
            </div>

            <div class="progress-section">
              <div class="progress-label">
                {{ getProgressLabel(event.type_evenement.libelle_type_evenement) }}
              </div>
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width.%]="event.niveau_avancement_pourcentage"
                     [style.background]="getProgressGradient(event.niveau_avancement_pourcentage)"></div>
              </div>
              <div class="progress-text">
                {{ event.niveau_avancement_pourcentage === 100 ? 'Terminé avec succès ✓' : event.niveau_avancement_pourcentage + '% complété' }}
              </div>
            </div>

            <!-- Coûts si disponibles -->
            <div class="couts-info" *ngIf="event.cout_estime || event.cout_reel">
              <div *ngIf="event.cout_estime">
                <strong>Coût estimé:</strong> {{ formatCurrency(event.cout_estime) }}
              </div>
              <div *ngIf="event.cout_reel">
                <strong>Coût réel:</strong> {{ formatCurrency(event.cout_reel) }}
              </div>
            </div>

            <div class="timeline-footer">
              <a href="#" class="btn btn-secondary ml-2" (click)="voirDocuments(event)" *ngIf="event.documents && event.documents.length > 0">
                Documents ({{ event.documents.length }})
              </a>
            </div>
          </div>
        </div>

        <!-- Indicateur de fin -->
        <div>
          <i class="fas fa-clock bg-gray"></i>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="evenementsSouscription.length > 0">
        <div class="pagination-info">
          <!-- Affichage de {{ getPaginationInfo() }} événements -->
        </div>
        <nz-pagination 
          [(nzPageIndex)]="currentPage"
          [nzTotal]="evenementsSouscription.length"
          [nzPageSize]="pageSize"
          [nzShowSizeChanger]="false"
          [nzShowQuickJumper]="false"
          [nzSimple]="false"
          (nzPageIndexChange)="onPageChange($event)">
        </nz-pagination>
      </div>

      <!-- Message si aucun événement de souscription -->
      <div *ngIf="evenementsSouscription.length === 0 && !loading" class="no-events-message">
        <p>Aucun événement de souscription trouvé.</p>
      </div>
    </div>
  </div>
</section>