<!-- Template HTML avec pagination corrigée -->

<!-- En-tête de la page -->
<div class="documents-header">
    <div class="header-content">
      <h1 class="page-title">
        <i nz-icon nzType="file-text" class="title-icon"></i>
        Gestion des Documents
      </h1>
      <p class="page-subtitle">Administrez tous les documents du système</p>
      
      <div class="header-actions">
        <button nz-button nzType="primary" (click)="rafraichir()" [nzLoading]="loading">
          <i nz-icon nzType="reload"></i>
          Actualiser
        </button>
      </div>
    </div>
  </div>
  
  <!-- Statistiques rapides -->
  <div class="stats-section" *ngIf="!loading && !error">
    <div class="stat-card">
      <div class="stat-value">{{ totalDocuments }}</div>
      <div class="stat-label">Total Documents</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ documents.length }}</div>
      <div class="stat-label">Documents Affichés</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ currentPage }}</div>
      <div class="stat-label">Page Actuelle</div>
    </div>
  </div>
  
  <!-- Zone de contenu principal -->
  <div class="main-content">
    
    <!-- État de chargement -->
    <div class="loading-container" *ngIf="loading">
      <nz-spin nzSize="large">
        <div class="loading-content">
          <div class="loading-icon">
            <i nz-icon nzType="file-sync" nzSpin></i>
          </div>
          <h3>Chargement des documents...</h3>
          <p>Récupération des données en cours</p>
        </div>
      </nz-spin>
    </div>
  
    <!-- Message d'erreur -->
    <div class="error-container" *ngIf="error && !loading">
      <div class="error-content">
        <div class="error-icon">
          <i nz-icon nzType="exclamation-circle"></i>
        </div>
        <h3>Erreur de chargement</h3>
        <p>{{ error }}</p>
        <button nz-button nzType="primary" (click)="retry()">
          <i nz-icon nzType="reload"></i>
          Réessayer
        </button>
      </div>
    </div>
  
    <!-- Zone principale sans données - DESIGN AMÉLIORÉ -->
    <div class="empty-state" *ngIf="!loading && !error && documents.length === 0">
      <div class="empty-content">
        <div class="empty-illustration">
          <div class="empty-icon-container">
            <i nz-icon nzType="inbox" class="empty-main-icon"></i>
            <div class="empty-decorative-icons">
              <i nz-icon nzType="file-text" class="floating-icon icon-1"></i>
              <i nz-icon nzType="file-pdf" class="floating-icon icon-2"></i>
              <i nz-icon nzType="file-image" class="floating-icon icon-3"></i>
            </div>
          </div>
        </div>
        
        <div class="empty-text">
          <h2>Aucun document trouvé</h2>
          <p class="empty-description">
            Il n'y a actuellement aucun document dans le système. 
            Les documents apparaîtront ici une fois qu'ils seront téléchargés par les utilisateurs.
          </p>
        </div>
        
        <div class="empty-actions">
          <button nz-button nzType="primary" nzSize="large" (click)="rafraichir()">
            <i nz-icon nzType="reload"></i>
            Actualiser la liste
          </button>
          <button nz-button nzType="default" nzSize="large">
            <i nz-icon nzType="question-circle"></i>
            Aide
          </button>
        </div>
        
        <div class="empty-suggestions">
          <h4>Suggestions :</h4>
          <ul>
            <li>Vérifiez que des utilisateurs ont téléchargé des documents</li>
            <li>Contactez l'équipe technique si le problème persiste</li>
            <li>Consultez les logs pour plus d'informations</li>
          </ul>
        </div>
      </div>
    </div>
  
    <!-- Liste des documents -->
    <div class="documents-grid" *ngIf="!loading && !error && documents.length > 0">
      <nz-card 
        class="document-card" 
        *ngFor="let doc of documents; let i = index"
        [nzHoverable]="true"
        [nzActions]="[actionConsulter, actionTelecharger]">
        
        <!-- En-tête de la carte -->
        <div class="document-header">
          <div class="document-icon">
            <i nz-icon [nzType]="getFileIcon(doc)" class="file-icon"></i>
          </div>
          <div class="document-badges">
            <nz-tag *ngIf="isRecent(doc.date_telechargement)" nzColor="green">
              Nouveau
            </nz-tag>
            <nz-tag [nzColor]="getStatutClass(doc.statut_document) === 'badge-success' ? 'green' : 'default'">
              {{ getStatutLabel(doc.statut_document) }}
            </nz-tag>
          </div>
        </div>
  
        <!-- Contenu principal -->
        <div class="document-content">
          <h3 class="document-title" 
              [nz-tooltip]="doc.nom_original"
              nzTooltipPlacement="top">
            {{ doc.nom_original }}
          </h3>
          
          <div class="document-meta">
            <div class="meta-item">
              <i nz-icon nzType="calendar"></i>
              <span>{{ formatDate(doc.date_telechargement) }}</span>
            </div>
            <div class="meta-item">
              <i nz-icon nzType="file"></i>
              <span>{{ formatTaille(doc.taille_fichier) }}</span>
            </div>
            <div class="meta-item">
              <i nz-icon nzType="tag"></i>
              <span>{{ getTypeDocument(doc) }}</span>
            </div>
          </div>
  
          <div class="document-description" *ngIf="doc.description_document">
            <p>{{ doc.description_document }}</p>
          </div>
  
          <div class="document-souscription">
            <i nz-icon nzType="link"></i>
            <span>{{ getSouscriptionInfo(doc) }}</span>
          </div>
        </div>
  
        <!-- Actions de la carte -->
        <ng-template #actionConsulter>
          <button nz-button nzType="text" (click)="onConsulter(doc)" nz-tooltip nzTooltipTitle="Consulter le document">
            <i nz-icon nzType="eye"></i>
          </button>
        </ng-template>
  
        <ng-template #actionTelecharger>
          <button nz-button nzType="text" (click)="telechargerDocument(doc)" nz-tooltip nzTooltipTitle="Télécharger">
            <i nz-icon nzType="download"></i>
          </button>
        </ng-template>
  
      </nz-card>
    </div>
  
    <!-- PAGINATION CORRIGÉE -->
    <div class="pagination-container" *ngIf="!loading && !error && totalDocuments > pageSize">
      <nz-pagination 
        [(nzPageIndex)]="currentPage"
        [nzTotal]="totalDocuments"
        [nzPageSize]="pageSize"
        [nzShowSizeChanger]="true"
        [nzShowQuickJumper]="true"
        [nzShowTotal]="totalTemplate"
        [nzPageSizeOptions]="[5, 10, 20, 50]"
        (nzPageIndexChange)="onPageChange($event)"
        (nzPageSizeChange)="onPageSizeChange($event)">
      </nz-pagination>
  
      <ng-template #totalTemplate let-total let-range="range">
        Affichage de {{ range[0] }} à {{ range[1] }} sur {{ total }} documents
      </ng-template>
    </div>
  
  </div>
